{% macro displayType(type, inlineUnion = true, purpleLink = true) %}
  {% if type.type === 'reference' %}
    {% if type.link %}
      <a class="underline {% if purpleLink %} text-purple-600 {% else %} text-blue-500 {% endif %}" href="{{ type.link }}/">{{type.value}}</a>
    {% else %}
      {{type.value}}
    {% endif %}
  {% elif type.type === 'array' %}
    <span class="inline-flex">
      <span>{{ displayType(type.value, inlineUnion, purpleLink) }}</span>
      <span>[]</span>
    </span>
  {% elif type.type === 'union' %}
    {% for type in type.value  %}
      {% if not inlineUnion %} | {% endif %}
      {{ displayType(type, inlineUnion, purpleLink) }}
      {% if not loop.last and inlineUnion %} | {% endif %}
      {% if not inlineUnion %} <br> {% endif %}
    {% endfor %}
  {% elif type.type === 'intersection' %}
    {% for type in type.value %}
      {% if not inlineUnion %} & {% endif %}
      {{ displayType(type, inlineUnion, purpleLink) }}
      {% if not loop.last and inlineUnion %} & {% endif %}
      {% if not inlineUnion %} <br> {% endif %}
    {% endfor %}
  {% elif type.type === 'reflection' %}
    <h5 class="h4 text-xl">Object</h4>
    {% for item in type.value %}
      <div class="ml-4 mb-2 py-2 {% if not loop.last %} border-b-2 border-dashed {% endif %}">
        <strong class="mb-2 font-mono">{{item.name}}</strong>: {{ displayType(item.type, sineRoot, inlineUnion, purpleLink) }}

        {{ displayComment(item) }}

        {{ displaySince(item) }}

        {% if item.type.type !== 'intrinsic' %}
          {{ displaySignature(item.type) }}
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    {{type.value}}
  {% endif %}
{% endmacro %}

{% macro displaySignature(signature) %}
  {{ displayComment(signature) }}

  {{ displaySince(signature) }}

  <h4 class="mt-4 text-xl">Signature</h3>
  <div class="font-mono bg-gray-800 text-white p-4 mb-2">
    {% if not signature.parameters %}
      <span class="text-purple-400">
        {% if signature.isCallback %}
          callback(): </span>{{ displayType(signature.type) }}
        {% else %}
          {{signature.name}}(): </span>{{ displayType(signature.type) }}
        {% endif %}
      </span>
    {% else %}
      <span class="text-purple-400">
        {% if signature.isCallback %}
        callback(
      {% else %}
        {{ signature.name }}(
      {% endif %}
      </span>
      {% for parameter in signature.parameters %}
        <div class="ml-4 flex">
          <span class="text-orange-400">{{parameter.name}}</span>
          <span class="text-white">:</span>
          <span class="ml-2">{{ displayType(parameter.type, true, false) }}</span>
          {% if not loop.last %}
            <span>,</span>{% endif %}
        </div>
      {% endfor %}
      <span class="text-purple-400">):</span>{{ displayType(signature.type, true, false) }}
    {% endif %}
  </div>

  {% if signature.parameters %}
    <h4 class="mt-4 text-xl">Parameters</h3>

    {% for parameter in signature.parameters %}
      <div class="mb-4">
        <strong class="mb-2 font-mono">
          <span>{{parameter.name}}:</span>
          {{ displayType(parameter.type) }}
        </strong>

        {{ displayComment(parameter) }}
      </div>
    {% endfor %}
  {% endif %}

  {% if signature.returns %}
    <h4 class="mt-4 text-xl">Returns</h4>
    <strong class="mb-2 font-mono">{{ displayType(signature.returns) }}</strong>
    <p class="mb-2">{{signature.returns | escape | nl2br}}</p>
  {% endif %}

  {% if signature.throws.length > 0 %}
    <h4 class="mt-4 text-xl">Throws</h3>

    {% for throw in signature.throws %}
      <p>
        <a class="underline text-purple-600 font-mono font-bold block" href="/api/core/{{throw.name | slug}}/">{{ throw.name }}</a>
        
        {{throw.description}}
      </p>
    {% endfor %}
  {% endif %}

  {% if signature.examples.length > 0 %}
    <h4 class="mt-4 text-xl">Examples</h4>

    {{displayExamples(signature.examples, true)}}
  {% endif %}
{% endmacro %}

{% macro displaySince(def) %}
  <p>
    <strong>Since</strong> <a class="underline text-purple-600 font-mono font-bold" href="/releases/{{def.package}}/{{ def.since }}/">{{ def.since }}</a>
  </p>
{% endmacro %}

{% macro displayComment(def) %}
  <p>{{def.description | escape | nlnl2br | safe}}</p>
{% endmacro %}

{% macro displayName(def) %}
  <h1 class="text-2xl">{{def.name}}{% if def.generic.length > 0 %}&lt;{% for generic in def.generic %}{{ generic.name }}{% if not loop.last %}, {% endif %}{% endfor %}&gt;{% endif %}</h1>
{% endmacro %}

{% macro displayExamples(examples, showTitle = false) %}
  {% for example in examples %}
    {% if showTitle %}
      <h5>{{example.title}}</h5>
    {% endif %}

    {% for part in example.parts %}
      {% if part.type === 'text' %}
        <p>{{part.text | escape | nlnl2br | safe }}</p>
      {% else %}
         {% highlight part.extension %}
          {% include part.fileName %}
          {% endhighlight %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endmacro %}